# # 가상 안경 피팅 룸

<br>

- 가상 환경에서 실시간으로 안경을 착용하여 착용한 모습을 동영상으로 저장해 주는 시스템

<br/>

![42](https://user-images.githubusercontent.com/53526987/121128850-01a96f00-c867-11eb-8252-defbbbb9b6b8.PNG)

<br/>

## 사용 기술

<br/>

- Python

- OpenCV(ML(Haar-like features + Cascade Classifier) + DL(SSD))

<br/>

## 문제 정의

<br/>

1. 오프라인에서 안경을 고르는 경우에는 여러 안경들을 쓴 모습을 한 번에 비교해 볼 수 없고 일일이 비교해야 한다는 점, 
2. 안경테에 상표가 걸려있거나 안경알에 스티커가 붙어있어 안경을 착용하고 객관적으로 평가하기 어렵다는 점, 
3. 안경테가 손상될 우려가 있다는 점, 
4. 안경을 만지고 써보면서 전염병이 전파될 수 있다는 점 등의 문제점이 존재합니다. 
5. 장소나 시간 등 주변 환경에 구애받는 다는 것 또한 오프라인에서 흔히 겪을 수 있는 문제점입니다. 

저희는 오프라인에서 안경을 고르는 경우 발생할 수 있는 여러 가지 문제점과 불편함을 해결하기 위해 <온라인 가상 안경 피팅 룸 (Online Virtual Spectacles Fitting room)> 서비스를 제공하게 되었습니다. 

​    

<br/>

## 실험 및 평가

<br/>

컴퓨터 웹캠을 통해 라이브로 안경을 피팅할 수 있고 해당 영상을 저장할 수 있습니다.

\- 처음 얼굴을 검출하는 과정에서 머신러닝(Haar Cascade)을 사용하여 특정 크기의 사각형을 키워가며 검출했습니다.

이로 인해 얼굴이 많이 가려지거나 하는 경우에는 인식을 하지 못하는 경우가 많았습니다.

그래서 OpenCV에서 제공하는 DNN 모듈(DL)을 사용하여 얼굴 검출 하는 것으로 변경하였습니다. DNN 모듈을 사용할 때 미리 학습된 딥러닝 모델을 이용하는 것으로  폴더를 찾고 가져오는 어려움이 있습니다.

밑의 자료를 보면 Haar Cascade 와 DL의 차이를 알 수 있습니다.

![noname01](https://user-images.githubusercontent.com/53526987/121129404-d7a47c80-c867-11eb-9b4d-5ee63b8c3816.png)

​    

자료<http://dl.opencv.org/present/cvpr_opencv.pdf>

​    \- 얼굴을 검출 한 후에 눈을 검출해야 합니다. 이 부분에서는 아직 Haar Cascade를 사용하고 있습니다. 얼굴 전체 부분에서 검출을 하면 정확도도 낮아지고 속도도 느려집니다. 그래서 얼굴의 윗부분을 범위로 정해서 눈을 검출하였습니다.

\- 합성을 조금 편리하게 하기 위해 두 눈이 수평할 경우를 가정하고 진행하였습니다.

화면에서 두 눈의 간격과 2D 이미지파일에서 두 눈의 간격을 계산하여 안경 합성을 진행하였습니다.

또한 2D 이미지를 사용하여 안경 태 부분이 보이지 않고 안경 자체의 회전은 없어 자연스럽지 않습니다.

그래서 얼굴이 돌아가는 것을 파악하여 3D 안경 이미지를 같이 회전시켜 합성하는 방법이 있을 것 같습니다.

​    

<br/>

## 결과

<br/>

![noname01](https://user-images.githubusercontent.com/53526987/121129548-15090a00-c868-11eb-8aba-3fe9c6e04fff.png)



1. 실시간으로 SSD 알고리즘(DL)을 사용해서 얼굴을 검출

2. 얼굴의 윗 부분에서 눈을 검출(ML)

3. 눈 과 안경의 위치를 파악하여 합성

4. 동영상으로 저장

​    

<br/>
